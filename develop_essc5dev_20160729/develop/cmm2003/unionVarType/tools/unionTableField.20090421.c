// Automatically generated codes
// Generated Date and Time 20090502105516
// Generated by ud090401

#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <unistd.h>

#ifndef _UnionLogMDL_3_x_
#define _UnionLogMDL_3_x_
#endif

#include "UnionLog.h"
#include "UnionStr.h"
#include "unionErrCode.h"
#include "unionREC.h"
#include "unionDataTBLList.h"

#include "unionTableField.h"
#include "unionComplexDBRecord.h"
#include "unionRecFile.h"

/*
功能：
	读取一个记录
输入参数:
	fldID	域标识
	prec	记录指针，必须对关键字域赋值
输出参数:
	prec	记录指针
返回值
	>=0		成功，返回记录的大小
	<0		失败,错误码
*/
int UnionReadTableField_2_x_Rec(char *fldID,PUnionTableField_2_x prec)
{
	int	ret;
	int	lenOfRecStr;
	char	recStr[8192*4+1];
	char	condition[1024+1];

	//从记录拼装串
	memset(condition,0,sizeof(condition));
	sprintf(condition,"ID=%s|",fldID);
	//读取记录
	memset(recStr,0,sizeof(recStr));
	if ((lenOfRecStr = UnionSelectUniqueObjectRecordByPrimaryKey(conTBLNameTableField,condition,recStr,sizeof(recStr))) < 0)
	{
		UnionUserErrLog("in UnionReadTableField_2_x_Rec:: UnionSelectUniqueObjectRecordByPrimaryKey! [%s] [%s]\n",conTBLNameTableField,condition);
		return(UnionSetUserDefinedErrorCode(lenOfRecStr));
	}
	//从记录串拼装结构
	if ((ret = UnionFormTableField_2_x_RecFromRecStr(recStr,lenOfRecStr,prec)) < 0)
	{
		UnionUserErrLog("in UnionReadTableField_2_x_Rec:: UnionFormTableField_2_x_RecFromRecStr!\n");
		return(UnionSetUserDefinedErrorCode(ret));
	}

	return(sizeof(*prec));
}

/*
功能：
	将记录结构转换为记录字串的函数
输入参数:
	recStr	记录字串
	lenOfRecStr	记录串长度
输出参数:
	prec	记录指针
返回值
	>=0		读出的域数目
	<0		失败,错误码
*/
int UnionFormTableField_2_x_RecFromRecStr(char *recStr,int lenOfRecStr,PUnionTableField_2_x prec)
{
	int	ret;

	if ((ret = UnionFormTableFieldRecFromRecStr(recStr,lenOfRecStr,&(prec->fld_1_x))) < 0)
	{
		UnionUserErrLog("in UnionFormTableField_2_x_RecFromRecStr:: UnionFormTableFieldRecFromRecStr from [%04d][%s]!\n",lenOfRecStr,recStr);
		return(UnionSetUserDefinedErrorCode(ret));
	}
	
	if ((ret = UnionReadRecFldFromRecStr(recStr,lenOfRecStr,conTableFieldFldNameDisplayName,
		prec->displayName,sizeof(prec->displayName))) < 0)
	{
		UnionUserErrLog("in UnionFormTableField_2_x_RecFromRecStr:: UnionReadRecFldFromRecStr fld [%s] from [%04d][%s]!\n",conTableFieldFldNameDisplayName,lenOfRecStr,recStr);
		return(UnionSetUserDefinedErrorCode(ret));
	}

	if ((ret = UnionReadRecFldFromRecStr(recStr,lenOfRecStr,conTableFieldFldNameCompilerSwitch,
		prec->compilerSwitch,sizeof(prec->compilerSwitch))) < 0)
	{
		UnionUserErrLog("in UnionFormTableField_2_x_RecFromRecStr:: UnionReadRecFldFromRecStr fld [%s] from [%04d][%s]!\n",conTableFieldFldNameCompilerSwitch,lenOfRecStr,recStr);
		return(UnionSetUserDefinedErrorCode(ret));
	}
	return(0);
}

/*
功能	
	将一个赋值方法写入到串中
输入参数
	method		赋值方法
输入出数
	desStr		目标串
返回值
	>=0	成功
	<0	错误码
*/
int UnionConvertValueAssignMethod(char *method,char *desStr)
{
	int	lenOfRecStr;
	char	recStr[8192+1];
	char	tmpBuf[256+1];
	char	*ptr;
	char	*startPtr;
	char	*endPtr;
	int	offset = 0;
	int	len = 0;
	int	ret;
	
	if ((ptr = strstr(method,"query::table=")) == NULL)
	{
		if ((ptr = strstr(method,"form::table=")) == NULL)
		{
			//sprintf(desStr,"value=%s|",method);
			strcpy(desStr,method);
			return(0);
		}
		offset = strlen("form::table=");
	}
	else
		offset = strlen("query::table=");
	startPtr = method + offset;
	for (len = strlen(method); offset < len; offset++)
	{
		if (method[offset] == ',')
		{
			endPtr = method + offset;
			*endPtr = 0;
			break;
		}
	}
	if (offset >= len)
	{
		UnionUserErrLog("in UnionConvertValueAssignMethod:: method = [%s] error!\n",method);
		return(errCodeSQLFldAssignMethodInvalid);
	}
	if (UnionIsDigitStr(startPtr))
	{
		*endPtr = ',';
		strcpy(desStr,method);
		return(0);
	}
	sprintf(tmpBuf,"tableName=%s|",startPtr);
	memset(recStr,0,sizeof(recStr));
	if ((lenOfRecStr = UnionSelectUniqueObjectRecordByPrimaryKey(conTBLNameTableList,tmpBuf,recStr,sizeof(recStr))) < 0)
	{
		UnionAuditLog("in UnionConvertValueAssignMethod:: UnionSelectUniqueObjectRecordByPrimaryKey [%s]\n",tmpBuf);
		if (offset < len)
			*endPtr = ',';
		//sprintf(desStr,"value=%s|",method);
		strcpy(desStr,method);
		return(0);
	}
	memset(tmpBuf,0,sizeof(tmpBuf));
	if ((ret = UnionReadRecFldFromRecStr(recStr,lenOfRecStr,"resID",tmpBuf,sizeof(tmpBuf))) < 0)
	{
		UnionUserErrLog("in UnionConvertValueAssignMethod:: UnionReadRecFldFromRecStr resID from [%s]\n",recStr);
		return(ret);
	}
	//UnionLog("*** resID = [%s]\n",tmpBuf);
	*startPtr = 0;
	*endPtr = ',';
	//sprintf(desStr,"value=%s%s%s|",method,tmpBuf,endPtr);
	sprintf(desStr,"%s%s%s",method,tmpBuf,endPtr);
	return(0);
}

/*
功能：
	结构的缺省赋值函数
输入参数:
	prec	记录指针
输出参数:
	无
返回值
	>=0		成功,拼装的记录串的长度
	<0		失败,错误码
*/
int UnionFormDefaultValueOfTableFieldRec(PUnionTableField prec)
{
	if (prec == NULL)
	{
		UnionUserErrLog("in UnionFormDefaultValueOfTableFieldRec:: prec is null!\n");
		return(UnionSetUserDefinedErrorCode(errCodeNullPointer));
	}
	memset(prec,0,sizeof(*prec));
	prec->fieldType = 1;
	prec->nullPermitted = 1;
	if (strlen("null") >= sizeof(prec->defaultValue))
	{
		UnionUserErrLog("in UnionFormDefaultValueOfTableFieldRec:: default value of [defaultValue] = [null] is too long!\n");
		return(UnionSetUserDefinedErrorCode(errCodeDefaultValueTooLong));
	}
	strcpy(prec->defaultValue,"null");
	if (strlen("1") >= sizeof(prec->value))
	{
		UnionUserErrLog("in UnionFormDefaultValueOfTableFieldRec:: default value of [value] = [1] is too long!\n");
		return(UnionSetUserDefinedErrorCode(errCodeDefaultValueTooLong));
	}
	strcpy(prec->value,"1");
	return(1);
}


/*
功能：
	将记录结构转换为记录字串的函数
输入参数:
	prec	记录指针
	sizeOfBuf	接收记录字串的缓冲的大小
输出参数:
	recStr	记录字串
返回值
	>=0		成功,拼装的记录串的长度
	<0		失败,错误码
*/
int UnionFormRecStrFromTableFieldRec(PUnionTableField prec,char *recStr,int sizeOfBuf)
{
	int	ret;
	int	offset = 0;

	if ((prec == NULL) || (recStr == NULL))
	{
		UnionUserErrLog("in UnionFormRecStrFromTableFieldRec:: prec or recStr is null!\n");
		return(UnionSetUserDefinedErrorCode(errCodeNullPointer));
	}
	ret = UnionPutRecFldIntoRecStr(conTableFieldFldNameFieldName,prec->fieldName,strlen(prec->fieldName),recStr+offset,sizeOfBuf-offset);
	if (ret < 0)
	{
		UnionUserErrLog("in UnionFormRecStrFromTableFieldRec:: UnionPutRecFldIntoRecStr [fieldName] error!\n");
		return(UnionSetUserDefinedErrorCode(ret));
	}
	offset += ret;
	ret = UnionPutIntTypeRecFldIntoRecStr(conTableFieldFldNameFieldType,prec->fieldType,recStr+offset,sizeOfBuf-offset);
	if (ret < 0)
	{
		UnionUserErrLog("in UnionFormRecStrFromTableFieldRec:: UnionPutIntTypeRecFldIntoRecStr [fieldType] error!\n");
		return(UnionSetUserDefinedErrorCode(ret));
	}
	offset += ret;
	ret = UnionPutRecFldIntoRecStr(conTableFieldFldNameID,prec->ID,strlen(prec->ID),recStr+offset,sizeOfBuf-offset);
	if (ret < 0)
	{
		UnionUserErrLog("in UnionFormRecStrFromTableFieldRec:: UnionPutRecFldIntoRecStr [ID] error!\n");
		return(UnionSetUserDefinedErrorCode(ret));
	}
	offset += ret;
	ret = UnionPutIntTypeRecFldIntoRecStr(conTableFieldFldNameSize,prec->size,recStr+offset,sizeOfBuf-offset);
	if (ret < 0)
	{
		UnionUserErrLog("in UnionFormRecStrFromTableFieldRec:: UnionPutIntTypeRecFldIntoRecStr [size] error!\n");
		return(UnionSetUserDefinedErrorCode(ret));
	}
	offset += ret;
	ret = UnionPutIntTypeRecFldIntoRecStr(conTableFieldFldNameNullPermitted,prec->nullPermitted,recStr+offset,sizeOfBuf-offset);
	if (ret < 0)
	{
		UnionUserErrLog("in UnionFormRecStrFromTableFieldRec:: UnionPutIntTypeRecFldIntoRecStr [nullPermitted] error!\n");
		return(UnionSetUserDefinedErrorCode(ret));
	}
	offset += ret;
	ret = UnionPutRecFldIntoRecStr(conTableFieldFldNameDefaultValue,prec->defaultValue,strlen(prec->defaultValue),recStr+offset,sizeOfBuf-offset);
	if (ret < 0)
	{
		UnionUserErrLog("in UnionFormRecStrFromTableFieldRec:: UnionPutRecFldIntoRecStr [defaultValue] error!\n");
		return(UnionSetUserDefinedErrorCode(ret));
	}
	offset += ret;
	ret = UnionPutRecFldIntoRecStr(conTableFieldFldNameValue,prec->value,strlen(prec->value),recStr+offset,sizeOfBuf-offset);
	if (ret < 0)
	{
		UnionUserErrLog("in UnionFormRecStrFromTableFieldRec:: UnionPutRecFldIntoRecStr [value] error!\n");
		return(UnionSetUserDefinedErrorCode(ret));
	}
	offset += ret;
	ret = UnionPutRecFldIntoRecStr(conTableFieldFldNameRemark,prec->remark,strlen(prec->remark),recStr+offset,sizeOfBuf-offset);
	if (ret < 0)
	{
		UnionUserErrLog("in UnionFormRecStrFromTableFieldRec:: UnionPutRecFldIntoRecStr [remark] error!\n");
		return(UnionSetUserDefinedErrorCode(ret));
	}
	offset += ret;
	ret = UnionPutRecFldIntoRecStr(conTableFieldFldNameConstraint,prec->valueConstraint,strlen(prec->valueConstraint),recStr+offset,sizeOfBuf-offset);
	if (ret < 0)
	{
		UnionUserErrLog("in UnionFormRecStrFromTableFieldRec:: UnionPutRecFldIntoRecStr [valueConstraint] error!\n");
		return(UnionSetUserDefinedErrorCode(ret));
	}
	offset += ret;
	ret = UnionPutRecFldIntoRecStr(conTableFieldFldNameInputTeller,prec->inputTeller,strlen(prec->inputTeller),recStr+offset,sizeOfBuf-offset);
	if (ret < 0)
	{
		UnionUserErrLog("in UnionFormRecStrFromTableFieldRec:: UnionPutRecFldIntoRecStr [inputTeller] error!\n");
		return(UnionSetUserDefinedErrorCode(ret));
	}
	offset += ret;
	ret = UnionPutRecFldIntoRecStr(conTableFieldFldNameInputDate,prec->inputDate,strlen(prec->inputDate),recStr+offset,sizeOfBuf-offset);
	if (ret < 0)
	{
		UnionUserErrLog("in UnionFormRecStrFromTableFieldRec:: UnionPutRecFldIntoRecStr [inputDate] error!\n");
		return(UnionSetUserDefinedErrorCode(ret));
	}
	offset += ret;
	ret = UnionPutRecFldIntoRecStr(conTableFieldFldNameInputTime,prec->inputTime,strlen(prec->inputTime),recStr+offset,sizeOfBuf-offset);
	if (ret < 0)
	{
		UnionUserErrLog("in UnionFormRecStrFromTableFieldRec:: UnionPutRecFldIntoRecStr [inputTime] error!\n");
		return(UnionSetUserDefinedErrorCode(ret));
	}
	offset += ret;
	ret = UnionPutRecFldIntoRecStr(conTableFieldFldNameUpdateTeller,prec->updateTeller,strlen(prec->updateTeller),recStr+offset,sizeOfBuf-offset);
	if (ret < 0)
	{
		UnionUserErrLog("in UnionFormRecStrFromTableFieldRec:: UnionPutRecFldIntoRecStr [updateTeller] error!\n");
		return(UnionSetUserDefinedErrorCode(ret));
	}
	offset += ret;
	ret = UnionPutRecFldIntoRecStr(conTableFieldFldNameUpdateDate,prec->updateDate,strlen(prec->updateDate),recStr+offset,sizeOfBuf-offset);
	if (ret < 0)
	{
		UnionUserErrLog("in UnionFormRecStrFromTableFieldRec:: UnionPutRecFldIntoRecStr [updateDate] error!\n");
		return(UnionSetUserDefinedErrorCode(ret));
	}
	offset += ret;
	ret = UnionPutRecFldIntoRecStr(conTableFieldFldNameUpdateTime,prec->updateTime,strlen(prec->updateTime),recStr+offset,sizeOfBuf-offset);
	if (ret < 0)
	{
		UnionUserErrLog("in UnionFormRecStrFromTableFieldRec:: UnionPutRecFldIntoRecStr [updateTime] error!\n");
		return(UnionSetUserDefinedErrorCode(ret));
	}
	offset += ret;
	return(offset);
}


/*
功能：
	将记录结构转换为记录字串的函数
输入参数:
	recStr	记录字串
	lenOfRecStr	记录串长度
输出参数:
	prec	记录指针
返回值
	>=0		读出的域数目
	<0		失败,错误码
*/
int UnionFormTableFieldRecFromRecStr(char *recStr,int lenOfRecStr,PUnionTableField prec)
{
	int	ret;
	char	value[512+1];
	
	if ((prec == NULL) || (recStr == NULL))
	{
		UnionUserErrLog("in UnionFormTableFieldRecFromRecStr:: prec or recStr is null!\n");
		return(UnionSetUserDefinedErrorCode(errCodeNullPointer));
	}
	UnionFormDefaultValueOfTableFieldRec(prec);
	ret = UnionReadRecFldFromRecStr(recStr,lenOfRecStr,conTableFieldFldNameFieldName,prec->fieldName,sizeof(prec->fieldName));
	if (ret < 0)
	{
		if (!0)
		{
			UnionUserErrLog("in UnionFormTableFieldRecFromRecStr:: UnionReadRecFldFromRecStr fld [fieldName] error from [%04d][%s]!\n",lenOfRecStr,recStr);
			return(UnionSetUserDefinedErrorCode(ret));
		}
	}
	ret = UnionReadIntTypeRecFldFromRecStr(recStr,lenOfRecStr,conTableFieldFldNameFieldType,&(prec->fieldType));
	if (ret < 0)
	{
		if (!0)
		{
			UnionUserErrLog("in UnionFormTableFieldRecFromRecStr:: UnionReadIntTypeRecFldFromRecStr fld [fieldType] error!\n");
			return(UnionSetUserDefinedErrorCode(ret));
		}
	}
	ret = UnionReadRecFldFromRecStr(recStr,lenOfRecStr,conTableFieldFldNameID,prec->ID,sizeof(prec->ID));
	if (ret < 0)
	{
		if (!0)
		{
			UnionUserErrLog("in UnionFormTableFieldRecFromRecStr:: UnionReadRecFldFromRecStr fld [ID] error!\n");
			return(UnionSetUserDefinedErrorCode(ret));
		}
	}
	ret = UnionReadIntTypeRecFldFromRecStr(recStr,lenOfRecStr,conTableFieldFldNameSize,&(prec->size));
	if (ret < 0)
	{
		if (!1)
		{
			UnionUserErrLog("in UnionFormTableFieldRecFromRecStr:: UnionReadIntTypeRecFldFromRecStr fld [size] error!\n");
			return(UnionSetUserDefinedErrorCode(ret));
		}
	}
	ret = UnionReadIntTypeRecFldFromRecStr(recStr,lenOfRecStr,conTableFieldFldNameNullPermitted,&(prec->nullPermitted));
	if (ret < 0)
	{
		if (!1)
		{
			UnionUserErrLog("in UnionFormTableFieldRecFromRecStr:: UnionReadIntTypeRecFldFromRecStr fld [nullPermitted] error!\n");
			return(UnionSetUserDefinedErrorCode(ret));
		}
	}
	ret = UnionReadRecFldFromRecStr(recStr,lenOfRecStr,conTableFieldFldNameDefaultValue,prec->defaultValue,sizeof(prec->defaultValue));
	if (ret < 0)
	{
		if (!1)
		{
			UnionUserErrLog("in UnionFormTableFieldRecFromRecStr:: UnionReadRecFldFromRecStr fld [defaultValue] error!\n");
			return(UnionSetUserDefinedErrorCode(ret));
		}
	}
	memset(value,0,sizeof(value));
	//ret = UnionReadRecFldFromRecStr(recStr,lenOfRecStr,conTableFieldFldNameValue,prec->value,sizeof(prec->value));
	ret = UnionReadRecFldFromRecStr(recStr,lenOfRecStr,conTableFieldFldNameValue,value,sizeof(value));
	if (ret < 0)
	{
		if (!1)
		{
			UnionUserErrLog("in UnionFormTableFieldRecFromRecStr:: UnionReadRecFldFromRecStr fld [value] error!\n");
			return(UnionSetUserDefinedErrorCode(ret));
		}
	}
	UnionConvertValueAssignMethod(value,prec->value);
	ret = UnionReadRecFldFromRecStr(recStr,lenOfRecStr,conTableFieldFldNameRemark,prec->remark,sizeof(prec->remark));
	if (ret < 0)
	{
		if (!1)
		{
			UnionUserErrLog("in UnionFormTableFieldRecFromRecStr:: UnionReadRecFldFromRecStr fld [remark] error!\n");
			return(UnionSetUserDefinedErrorCode(ret));
		}
	}
	ret = UnionReadRecFldFromRecStr(recStr,lenOfRecStr,conTableFieldFldNameConstraint,prec->valueConstraint,sizeof(prec->valueConstraint));
	if (ret < 0)
	{
		if (!1)
		{
			UnionUserErrLog("in UnionFormTableFieldRecFromRecStr:: UnionReadRecFldFromRecStr fld [valueConstraint] error!\n");
			return(UnionSetUserDefinedErrorCode(ret));
		}
	}
	ret = UnionReadRecFldFromRecStr(recStr,lenOfRecStr,conTableFieldFldNameInputTeller,prec->inputTeller,sizeof(prec->inputTeller));
	if (ret < 0)
	{
		if (!1)
		{
			UnionUserErrLog("in UnionFormTableFieldRecFromRecStr:: UnionReadRecFldFromRecStr fld [inputTeller] error!\n");
			return(UnionSetUserDefinedErrorCode(ret));
		}
	}
	ret = UnionReadRecFldFromRecStr(recStr,lenOfRecStr,conTableFieldFldNameInputDate,prec->inputDate,sizeof(prec->inputDate));
	if (ret < 0)
	{
		if (!1)
		{
			UnionUserErrLog("in UnionFormTableFieldRecFromRecStr:: UnionReadRecFldFromRecStr fld [inputDate] error!\n");
			return(UnionSetUserDefinedErrorCode(ret));
		}
	}
	ret = UnionReadRecFldFromRecStr(recStr,lenOfRecStr,conTableFieldFldNameInputTime,prec->inputTime,sizeof(prec->inputTime));
	if (ret < 0)
	{
		if (!1)
		{
			UnionUserErrLog("in UnionFormTableFieldRecFromRecStr:: UnionReadRecFldFromRecStr fld [inputTime] error!\n");
			return(UnionSetUserDefinedErrorCode(ret));
		}
	}
	ret = UnionReadRecFldFromRecStr(recStr,lenOfRecStr,conTableFieldFldNameUpdateTeller,prec->updateTeller,sizeof(prec->updateTeller));
	if (ret < 0)
	{
		if (!1)
		{
			UnionUserErrLog("in UnionFormTableFieldRecFromRecStr:: UnionReadRecFldFromRecStr fld [updateTeller] error!\n");
			return(UnionSetUserDefinedErrorCode(ret));
		}
	}
	ret = UnionReadRecFldFromRecStr(recStr,lenOfRecStr,conTableFieldFldNameUpdateDate,prec->updateDate,sizeof(prec->updateDate));
	if (ret < 0)
	{
		if (!1)
		{
			UnionUserErrLog("in UnionFormTableFieldRecFromRecStr:: UnionReadRecFldFromRecStr fld [updateDate] error!\n");
			return(UnionSetUserDefinedErrorCode(ret));
		}
	}
	ret = UnionReadRecFldFromRecStr(recStr,lenOfRecStr,conTableFieldFldNameUpdateTime,prec->updateTime,sizeof(prec->updateTime));
	if (ret < 0)
	{
		if (!1)
		{
			UnionUserErrLog("in UnionFormTableFieldRecFromRecStr:: UnionReadRecFldFromRecStr fld [updateTime] error!\n");
			return(UnionSetUserDefinedErrorCode(ret));
		}
	}
	return(0);
}


/*
功能：
	插入一个记录
输入参数:
	prec	记录指针
输出参数:
	prec	记录指针
返回值
	>=0		成功，返回记录的大小
	<0		失败,错误码
*/
int UnionInsertTableFieldRec(PUnionTableField prec)
{
	int	ret;
	int	lenOfRecStr;
	char	recStr[8192*4+1];

	//从记录拼装串
	memset(recStr,0,sizeof(recStr));
	if ((lenOfRecStr = UnionFormRecStrFromTableFieldRec(prec,recStr,sizeof(recStr))) < 0)
	{
		UnionUserErrLog("in UnionInsertTableFieldRec:: UnionFormRecStrFromTableFieldRec!\n");
		return(UnionSetUserDefinedErrorCode(lenOfRecStr));
	}

	//插入记录
	if ((ret = UnionInsertObjectRecord(conTBLNameTableField,recStr,lenOfRecStr)) < 0)
	{
		UnionUserErrLog("in UnionInsertTableFieldRec:: UnionInsertObjectRecord!\n");
		return(UnionSetUserDefinedErrorCode(ret));
	}

	return(ret);
}


/*
功能：
	删除一个记录
输入参数:
	prec	记录指针
输出参数:
	prec	记录指针
返回值
	>=0		成功，返回记录的大小
	<0		失败,错误码
*/
int UnionDeleteTableFieldRec(PUnionTableField prec)
{
	int	ret;
	int	lenOfRecStr;
	char	recStr[8192*4+1];

	//从记录拼装串
	memset(recStr,0,sizeof(recStr));
	if ((lenOfRecStr = UnionFormRecStrFromTableFieldRec(prec,recStr,sizeof(recStr))) < 0)
	{
		UnionUserErrLog("in UnionDeleteTableFieldRec:: UnionFormRecStrFromTableFieldRec!\n");
		return(UnionSetUserDefinedErrorCode(lenOfRecStr));
	}

	//删除记录
	if ((ret = UnionDeleteUniqueObjectRecord(conTBLNameTableField,recStr)) < 0)
	{
		UnionUserErrLog("in UnionDeleteTableFieldRec:: UnionDeleteUniqueObjectRecord!\n");
		return(UnionSetUserDefinedErrorCode(ret));
	}

	return(ret);
}


/*
功能：
	修改一个记录
输入参数:
	prec	记录指针
输出参数:
	prec	记录指针
返回值
	>=0		成功，返回记录的大小
	<0		失败,错误码
*/
int UnionUpdateTableFieldRec(PUnionTableField prec)
{
	int	ret;
	int	lenOfRecStr;
	char	recStr[8192*4+1];

	//从记录拼装串
	memset(recStr,0,sizeof(recStr));
	if ((lenOfRecStr = UnionFormRecStrFromTableFieldRec(prec,recStr,sizeof(recStr))) < 0)
	{
		UnionUserErrLog("in UnionUpdateTableFieldRec:: UnionFormRecStrFromTableFieldRec!\n");
		return(UnionSetUserDefinedErrorCode(lenOfRecStr));
	}

	//修改记录
	if ((ret = UnionUpdateUniqueObjectRecord(conTBLNameTableField,recStr,recStr,lenOfRecStr)) < 0)
	{
		UnionUserErrLog("in UnionUpdateTableFieldRec:: UnionUpdateUniqueObjectRecord!\n");
		return(UnionSetUserDefinedErrorCode(ret));
	}

	return(ret);
}


/*
功能：
	读取一个记录
输入参数:
	prec	记录指针，必须对关键字域赋值
输出参数:
	prec	记录指针
返回值
	>=0		成功，返回记录的大小
	<0		失败,错误码
*/
int UnionReadTableFieldRec(PUnionTableField prec)
{
	int			ret;
	TUnionTableField_2_x	fld2_xRec;
	int			useUnionTableFieldVer = 0;
	
	if (prec == NULL)
		return(errCodeParameter);
		
	// 判断是否使用2.x版本的域定义
	if ((useUnionTableFieldVer = UnionReadIntTypeRECVar("useUnionTableFieldVer")) <= 0)
		useUnionTableFieldVer = 1;
	switch (useUnionTableFieldVer)
	{
		case	2:
			memset(&fld2_xRec,0,sizeof(fld2_xRec));
			if ((ret = UnionReadTableField_2_x_Rec(prec->ID,&fld2_xRec)) < 0)
			{
				UnionUserErrLog("in UnionReadTableFieldRec:: UnionReadTableField_2_x_Rec! [%s]!\n",prec->ID);
				return(ret);
			}
			memcpy(prec,&(fld2_xRec.fld_1_x),sizeof(*prec));
			if (strlen(fld2_xRec.displayName) != 0)
				strcpy(prec->ID,fld2_xRec.displayName);
			return(0);
		default:
			return(UnionReadTableField_1_xRec(prec));
	}
}			

/*
功能：
	读取一个记录
输入参数:
	prec	记录指针，必须对关键字域赋值
输出参数:
	prec	记录指针
返回值
	>=0		成功，返回记录的大小
	<0		失败,错误码
*/
int UnionReadTableField_1_xRec(PUnionTableField_1_x prec)
{
	int	ret;
	int	lenOfRecStr;
	char	recStr[8192*4+1];
	char	condition[1024+1];

	//从记录拼装串
	memset(condition,0,sizeof(condition));
	sprintf(condition,"ID=%s|",prec->ID);
	/*
	if ((ret = UnionFormRecStrFromTableFieldRec(prec,condition,sizeof(condition))) < 0)
	{
		UnionUserErrLog("in UnionReadTableField_1_xRec:: UnionFormRecStrFromTableFieldRec!\n");
		return(UnionSetUserDefinedErrorCode(ret));
	}
	*/
	//读取记录
	memset(recStr,0,sizeof(recStr));
	if ((lenOfRecStr = UnionSelectUniqueObjectRecordByPrimaryKey(conTBLNameTableField,condition,recStr,sizeof(recStr))) < 0)
	{
		UnionUserErrLog("in UnionReadTableField_1_xRec:: UnionSelectUniqueObjectRecordByPrimaryKey! [%s] [%s]\n",conTBLNameTableField,condition);
		return(UnionSetUserDefinedErrorCode(lenOfRecStr));
	}
	//UnionLog("in UnionReadTableField_1_xRec:: [%04d][%s] on [%s]\n",lenOfRecStr,recStr,condition);
	//从记录串拼装结构
	if ((ret = UnionFormTableFieldRecFromRecStr(recStr,lenOfRecStr,prec)) < 0)
	{
		UnionUserErrLog("in UnionReadTableField_1_xRec:: UnionFormTableFieldRecFromRecStr!\n");
		return(UnionSetUserDefinedErrorCode(ret));
	}
	//UnionLog("in UnionReadTableField_1_xRec:: [%04d][%s] on [%s]\n",lenOfRecStr,recStr,condition);
	UnionProgramerLog("value = [%s] of [%s]\n",prec->value,prec->ID);

	return(sizeof(*prec));
}

/*
功能：
	根据域标识读取一个域名称
输入参数:
	fldID	域标识
输出参数:
	fldName	域名称
返回值
	>=0		成功，返回域名称的长度
	<0		失败,错误码
*/
int UnionReadTableFldNameByFldID(char *fldID,char *fldName)
{
	int	ret;
	TUnionTableField	rec;

	if ((fldID == NULL) || (strlen(fldID) >= sizeof(rec.ID)))	
	{
		UnionUserErrLog("in UnionReadTableFldNameByFldID:: parameter error!\n");
		return(UnionSetUserDefinedErrorCode(errCodeParameter));
	}
	memset(&rec,0,sizeof(rec));
	strcpy(rec.ID,fldID);
	if ((ret = UnionReadTableFieldRec(&rec)) < 0)
	{
		UnionUserErrLog("in UnionReadTableFldNameByFldID:: UnionReadTableFieldRec!\n");
		return(UnionSetUserDefinedErrorCode(ret));
	}
	strcpy(fldName,rec.fieldName);
	return(strlen(fldName));
}

/*
功能：
	根据条件，批量读取数据
输入参数:
	condition	条件字串
	maxRecNum		读取的最大记录数量
输出参数:
	recGrp		记录数组
返回值
	>=0		成功,读取的记录数量
	<0		失败,错误码
*/
int UnionBatchReadTableFieldRec(char *condition,TUnionTableField recGrp[],int maxRecNum)
{
	int	ret;
	char	fileName[512+1];
	int	recNum = 0;
	FILE	*recFileFp = NULL;
	char	recStr[8192*2+1];
	int	lenOfRecStr;
	TUnionTableField	rec;

	memset(fileName,0,sizeof(fileName));
	sprintf(fileName,"%s/pid-%d.tmp",getenv("UNIONTEMP"),getpid());

	// 读所有记录
	if ((ret = UnionBatchSelectObjectRecord(conTBLNameTableField,condition,fileName)) < 0)
	{
		UnionUserErrLog("in UnionBatchReadTableFieldRec:: UnionBatchSelectObjectRecord from [%s] on [%s]!\n",conTBLNameTableField,condition);
		return(ret);
	}
	// 打开文件
	if ((recFileFp = fopen(fileName,"r")) == NULL)
	{
		UnionUserErrLog("in UnionBatchReadTableFieldRec:: fopen [%s]\n",fileName);
		goto errExit;
	}
	while (!feof(recFileFp))
	{
		if (recNum >= maxRecNum)
		{
			UnionLog("in UnionBatchReadTableFieldRec:: still exists records satisfy the condition [%s]!\n",condition);
			ret = recNum;
			goto errExit;
		}
		memset(recStr,0,sizeof(recStr));
		if ((lenOfRecStr = UnionReadOneDataLineFromTxtFile(recFileFp,recStr,sizeof(recStr))) <= 0)
			continue;
		memset(&rec,0,sizeof(rec));
		if ((ret = UnionFormTableFieldRecFromRecStr(recStr,lenOfRecStr,&rec)) < 0)
		{
			UnionUserErrLog("in UnionBatchReadTableFieldRec:: UnionFormTableFieldRecFromRecStr from [%04d] [%s]\n",lenOfRecStr,recStr);
			goto errExit;
		}
		memcpy(&(recGrp[recNum]),&rec,sizeof(rec));
		recNum++;
	}
	ret = recNum;
errExit:
	fclose(recFileFp);
	UnionDeleteFile(fileName);
	return(ret);

}

